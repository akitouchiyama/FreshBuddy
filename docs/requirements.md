# FreshBuddy 要件定義書

## 1. プロジェクト概要

**プロジェクト名**: FreshBuddy（フレッシュバディ）

**サービス概要**: 食品の在庫と賞味期限を管理し、賞味期限が近づいたらお知らせをする、保持している食品を一覧で管理するWebアプリケーション

**バージョン**: 1.0（初期版）

**作成日**: 2025-11-08

---

## 2. 背景と目的

### 2.1 背景・きっかけ
- 買った食品の賞味期限を切らしてしまうことが多い
- 同じ食品を重複して買ってしまうことがある
- 一人暮らしを始めたばかりの人が、食品管理に困っている

### 2.2 解決したい課題
1. 食品の賞味期限切れによる食品ロスの削減
2. 重複購入の防止
3. 冷蔵庫・食品棚の在庫の可視化
4. 賞味期限が近づいた食品の早期発見と通知

### 2.3 プロジェクトの目的
一人暮らしを始めたばかりの人が、簡単に食品を管理でき、賞味期限切れや重複購入を防ぐことで、食品ロスを削減し、経済的負担を軽減する。

---

## 3. ターゲットユーザー

### 3.1 主要ターゲット
- **一人暮らしを始めたばかりの人**
  - 学生（大学生、専門学校生）
  - 新社会人
  - 年齢層: 18〜25歳

### 3.2 ユーザーの特徴
- 食品管理の経験が少ない
- 忙しくて細かい管理が難しい
- スマートフォンを日常的に使用している
- 音声入力など、手軽な入力方法を好む

---

## 4. 差別化ポイント

### 4.1 類似サービス
- **Limiter**: 既存の食品賞味期限管理アプリ

### 4.2 FreshBuddyの差別化ポイント
1. **音声入力による食品登録**
   - 冷蔵庫から食品を取り出したときに、音声で食品名と賞味期限を登録できる
   - 手が塞がっていても、ハンズフリーで登録可能
   - 入力のハードルを下げることで、継続的な利用を促進

2. **シンプルで使いやすいUI**
   - 一人暮らしを始めたばかりの人でも直感的に使える

---

## 5. 主要機能（MVP: Minimum Viable Product）

### 5.1 必須機能

#### 5.1.1 ユーザー管理
- [ ] ユーザー登録
- [ ] ログイン/ログアウト
- [ ] パスワードリセット

#### 5.1.2 食品登録・管理
- [ ] 食品の手動登録（テキスト入力）
  - 食品名
  - 購入日（任意）
  - 賞味期限
  - カテゴリ（冷蔵、冷凍、常温など）
  - 保存場所（冷蔵庫、冷凍庫、食品棚など）
- [ ] **音声入力による食品登録**
  - 音声認識API連携
  - 「牛乳、賞味期限11月15日」のような自然な発話で登録
- [ ] 食品情報の編集
- [ ] 食品の削除（消費完了時）
- [ ] 食品一覧表示
  - 賞味期限順にソート
  - カテゴリ別フィルター
  - 保存場所別フィルター

#### 5.1.3 通知機能
- [ ] 賞味期限が近づいた食品の通知
  - 賞味期限の3日前、1日前に通知
  - 通知設定のカスタマイズ可能
- [ ] Webプッシュ通知
- [ ] メール通知（オプション）

#### 5.1.4 検索機能
- [ ] 食品名で検索
- [ ] 保持している食品を一覧で確認
  - 「牛乳を既に持っているか」をすぐに確認できる

---

## 6. ユーザーストーリー

### 6.1 食品登録
```
As a ユーザー
I want 買い物から帰ってきたときに、音声で食品を登録したい
So that 手が塞がっていても、簡単に食品を記録できる
```

### 6.2 在庫確認
```
As a ユーザー
I want スーパーで買い物中に、冷蔵庫に牛乳があるか確認したい
So that 重複購入を防ぐことができる
```

### 6.3 賞味期限通知
```
As a ユーザー
I want 賞味期限が近い食品を通知してほしい
So that 食品を無駄にせず、計画的に消費できる
```

### 6.4 食品一覧
```
As a ユーザー
I want 冷蔵庫にある食品を一覧で見たい
So that 何があるか把握して、献立を考えられる
```

---

## 7. 機能要件詳細

### 7.1 音声入力機能
- **入力例**:
  - 「牛乳、賞味期限11月15日」
  - 「トマト、明後日まで」
  - 「卵、2025年11月20日」
- **音声認識の対応**:
  - 日付の自然言語理解（「明日」「明後日」「来週の月曜日」など）
  - 一般的な食品名の認識
- **エラーハンドリング**:
  - 認識できなかった場合は、テキスト入力に切り替え
  - 確認画面で内容を修正可能

### 7.2 通知タイミング
| 通知タイプ | タイミング | 内容 |
|-----------|----------|------|
| 期限間近通知 | 賞味期限の3日前 | 「〇〇の賞味期限が3日後です」 |
| 期限直前通知 | 賞味期限の1日前 | 「〇〇の賞味期限が明日です！」 |
| 期限当日通知 | 賞味期限当日 | 「〇〇の賞味期限が今日です！」 |
| 期限切れ通知 | 賞味期限翌日 | 「〇〇が賞味期限切れです」 |

### 7.3 カテゴリと保存場所
- **カテゴリ**:
  - 冷蔵
  - 冷凍
  - 常温
- **保存場所**（詳細）:
  - 冷蔵庫
  - 冷凍庫
  - 野菜室
  - 食品棚
  - その他

---

## 8. 非機能要件

### 8.1 パフォーマンス
- ページ読み込み時間: 3秒以内
- 音声認識レスポンス: 2秒以内

### 8.2 セキュリティ
- パスワードのハッシュ化
- HTTPS通信
- CSRF対策
- XSS対策

### 8.3 ユーザビリティ
- スマートフォン対応（レスポンシブデザイン）
- 直感的で分かりやすいUI
- 音声入力ボタンの視認性

### 8.4 対応ブラウザ
- Chrome（最新版）
- Safari（最新版）
- Firefox（最新版）
- Edge（最新版）

---

## 9. 将来的な拡張機能案

### 9.1 Phase 2（将来的に追加を検討）
- [ ] バーコードスキャン機能
  - 商品バーコードを読み取って自動登録
- [ ] レシピ提案機能
  - 賞味期限が近い食品を使ったレシピを提案
- [ ] 買い物リスト機能
  - よく買う食品の登録
  - 在庫が少なくなったら買い物リストに追加
- [ ] 家族・ルームシェア対応
  - 複数ユーザーで1つの食品リストを共有
- [ ] 統計機能
  - 食品ロス削減の効果を可視化
  - 月間の食品ロス量をグラフ表示

### 9.2 Phase 3（長期的な展望）
- [ ] モバイルアプリ化（iOS/Android）
- [ ] AI による賞味期限予測
- [ ] スーパーの特売情報連携
- [ ] 栄養バランス分析

---

## 10. システムアーキテクチャ

### 10.1 アーキテクチャ概要
FreshBuddyは、バックエンド（Flask REST API）とフロントエンド（React + TypeScript）を分離した**SPA（Single Page Application）アーキテクチャ**を採用します。

```
┌─────────────────────────────────────────────────────────┐
│                     クライアント                          │
│              (React + TypeScript)                       │
│  ┌───────────────────────────────────────────────┐     │
│  │  - UI/UX (コンポーネント)                       │     │
│  │  - 状態管理 (React Context / Redux)            │     │
│  │  - 音声認識 (Web Speech API)                   │     │
│  │  - API通信 (Fetch)                            │     │
│  └───────────────────────────────────────────────┘     │
└─────────────────────────────────────────────────────────┘
                            ↕ REST API (JSON)
┌─────────────────────────────────────────────────────────┐
│                  バックエンド (Flask)                     │
│  ┌───────────────────────────────────────────────┐     │
│  │  - RESTful API (Flask Blueprint)              │     │
│  │  - 認証 (Flask-JWT-Extended)                   │     │
│  │  - ORM (SQLAlchemy)                           │     │
│  │  - バリデーション (Marshmallow)                │     │
│  │  - タスクキュー (Celery + Redis)              │     │
│  └───────────────────────────────────────────────┘     │
└─────────────────────────────────────────────────────────┘
                            ↕
┌─────────────────────────────────────────────────────────┐
│              データベース (PostgreSQL)                    │
└─────────────────────────────────────────────────────────┘
```

---

## 11. 技術スタック

### 11.1 バックエンド

#### **Webフレームワーク: Flask 3.x**
**選定理由**:
- 軽量でシンプル、学習コストが低い
- REST APIの構築に適している
- 豊富なエクステンション（拡張機能）
- マイクロサービスアーキテクチャに向いている

**主要なFlask拡張**:
- **Flask-SQLAlchemy**: ORM（データベース操作）
- **Flask-JWT-Extended**: JWT認証
- **Flask-Marshmallow**: シリアライゼーション/バリデーション
- **Flask-CORS**: CORS（クロスオリジン）対応
- **Flask-Mail**: メール送信
- **Flask-Migrate**: データベースマイグレーション

#### **データベース: PostgreSQL 15+**
**選定理由**:
- 信頼性・安定性が高い
- SQLAlchemyとの相性が良い
- 本番環境でも広く使われている
- JSON型のサポート（柔軟なデータ保存）

**開発環境**: SQLite（開発初期）→ PostgreSQL（本番）

#### **タスクキュー: Celery + Redis**
**用途**:
- 賞味期限通知の定期実行
- メール送信の非同期処理
- バックグラウンドタスク

---

### 11.2 フロントエンド

#### **フレームワーク: React 18+ with TypeScript**
**選定理由**:
- 型安全性（TypeScriptによる）
- コンポーネントベースの開発
- 豊富なエコシステム
- PWA対応が容易

**主要ライブラリ**:
- **React Router**: ルーティング
- **Fetch API**: HTTP通信（ブラウザ標準、追加依存なし）
- **React Query (TanStack Query)**: サーバーステート管理
- **React Hook Form**: フォーム管理
- **Tailwind CSS**: CSSフレームワーク
- **date-fns**: 日付操作

#### **ビルドツール: Vite**
**選定理由**:
- 高速なHMR（Hot Module Replacement）
- TypeScriptサポート
- 軽量で設定が簡単

#### **状態管理: React Context API（初期）/ Zustand（必要に応じて）**
**選定理由**:
- 小規模なアプリにはContext APIで十分
- Zustandは軽量でシンプル（Reduxより学習コストが低い）

---

### 11.3 音声認識

#### **Web Speech API**
**選定理由**:
- ブラウザ標準機能（追加コスト不要）
- 日本語対応
- リアルタイム認識
- 実装が簡単

**対応ブラウザ**:
- Chrome, Edge (Chromium): ✅ 完全対応
- Safari: ✅ 対応（iOS含む）
- Firefox: ⚠️ 部分対応（フラグ有効化が必要）

**将来的な代替案**:
- Google Cloud Speech-to-Text（より高精度が必要な場合）

---

### 11.4 インフラ・デプロイ

#### **推奨構成1: Render（最もコスパが良い）**

| サービス | 用途 | 料金 |
|---------|------|------|
| **Render Web Service** | Flaskバックエンド | 無料枠あり（$7/月〜） |
| **Render PostgreSQL** | データベース | 無料枠あり（$7/月〜） |
| **Render Static Site** | React（ビルド済み） | **無料** |
| **Redis** | Celeryタスクキュー | 外部サービス（Upstash無料枠） |

**月額コスト**: 無料〜$14/月（有料プラン）

**メリット**:
- 簡単なデプロイ（GitHubと連携）
- 自動デプロイ（CI/CD）
- SSL証明書自動発行
- ログ・モニタリング機能
- 無料枠が充実

**デメリット**:
- 無料プランはスリープあり（アクセスがないと停止）
- リージョンが限定的（US/EU）

---

#### **推奨構成2: Vercel + Railway（フロントとバックを分離）**

| サービス | 用途 | 料金 |
|---------|------|------|
| **Vercel** | React（フロントエンド） | **無料** |
| **Railway** | Flask + PostgreSQL + Redis | $5/月〜（使用量ベース） |

**月額コスト**: 無料〜$5/月

**メリット**:
- Vercelはフロントエンドに最適化（高速CDN）
- Railwayは使った分だけ課金
- どちらもGitHub連携で自動デプロイ

---

#### **推奨構成3: AWS Lightsail（EC2より安価）**

| サービス | 用途 | 料金 |
|---------|------|------|
| **Lightsail Instance** | Flask + PostgreSQL + Redis + React（Nginx） | $5/月〜 |

**月額コスト**: $5/月〜

**メリット**:
- EC2より安価でシンプル
- 固定料金で予測しやすい
- SSH接続可能（フルコントロール）
- データ転送量込み

**デメリット**:
- 手動でのセットアップが必要
- スケーリングに限界あり

---

#### **参考: AWS EC2（フルコントロールが必要な場合）**

| サービス | 用途 | 料金 |
|---------|------|------|
| **EC2 (t3.micro)** | Flask + React（Nginx） | $8.5/月〜 |
| **RDS PostgreSQL (db.t3.micro)** | データベース | $15/月〜 |
| **ElastiCache Redis** | タスクキュー | $13/月〜 |

**月額コスト**: $36.5/月〜

**メリット**:
- フルコントロール
- 豊富なAWSサービスとの連携
- スケーラビリティ

**デメリット**:
- 高コスト
- セットアップ・運用の複雑さ

---

### 11.5 インフラ推奨まとめ

**初期開発・個人利用**:
→ **Render（推奨構成1）** または **Vercel + Railway（推奨構成2）**
- 月額無料〜$14で運用可能
- 簡単デプロイ、メンテナンス不要

**本格運用・将来的な拡張を見据える**:
→ **AWS Lightsail（推奨構成3）** または **AWS EC2**
- より細かい制御が可能
- スケーリング対応

---

### 11.6 その他のツール・サービス

#### **開発・運用ツール**
- **Git / GitHub**: バージョン管理・コード管理
- **GitHub Actions**: CI/CD（テスト自動化、デプロイ自動化）
- **Docker**: コンテナ化（開発環境統一、デプロイ簡素化）
- **pytest**: Pythonテストフレームワーク
- **Jest / React Testing Library**: フロントエンドテスト
- **ESLint / Prettier**: コードフォーマット・リンティング
- **Ruff**: Python リンティング（高速）

#### **監視・ログ**
- **Sentry**: エラートラッキング（無料枠あり）
- **Render / Railway ログ機能**: サーバーログ確認

#### **メール送信**
- **Resend**: モダンなメールAPI（無料枠: 3,000通/月）
- **SendGrid**: 無料枠100通/日
- **Gmail SMTP**: 開発環境用

---

### 11.7 開発環境

#### **必要なツール**
- **Python 3.11+**: バックエンド開発
- **Node.js 20+ (LTS)**: フロントエンド開発
- **PostgreSQL**: ローカル開発用DB（または Docker）
- **Redis**: ローカル開発用（または Docker）
- **Git**: バージョン管理
- **VS Code**: エディタ（推奨）

#### **推奨VS Code拡張**
- Python
- Pylance
- ES7+ React/Redux/React-Native snippets
- Tailwind CSS IntelliSense
- ESLint
- Prettier
- Docker

---

## 12. 技術的検討事項

### 12.1 音声認識API候補
- **Web Speech API**（ブラウザ標準、無料）← **採用**
- Google Cloud Speech-to-Text（将来的な検討）
- Azure Speech Services
- AWS Transcribe

### 12.2 通知方法
- **Web Push API**（PWA対応）← **採用**
- メール通知（Resend、SendGrid）← **採用**
- LINE Notify（将来的な検討）

### 12.3 データベース設計の主要エンティティ
- **User**（ユーザー）
- **FoodItem**（食品）
- **Category**（カテゴリ）
- **NotificationSetting**（通知設定）
- **NotificationHistory**（通知履歴）

---

## 13. 次のステップ

1. ✅ 技術スタックの選定（完了）
2. データベース設計（ER図作成）
3. API仕様書の作成
4. 画面設計（ワイヤーフレーム作成）
5. 開発環境のセットアップ
6. プロジェクト構造の作成
7. MVP機能の実装開始

---

## 14. 付録

### 14.1 参考資料
- 類似サービス: Limiter
- 音声認識技術: Web Speech API
- Flask公式ドキュメント: https://flask.palletsprojects.com/
- React公式ドキュメント: https://react.dev/

### 14.2 用語集
- **MVP**: Minimum Viable Product（実用最小限の製品）
- **PWA**: Progressive Web App（プログレッシブウェブアプリ）
- **Web Push**: Webプッシュ通知
- **SPA**: Single Page Application（シングルページアプリケーション）
- **REST API**: REpresentational State Transfer API
- **JWT**: JSON Web Token（認証トークン）
- **ORM**: Object-Relational Mapping（オブジェクト関係マッピング）
- **CORS**: Cross-Origin Resource Sharing（クロスオリジンリソース共有）

---

**文書履歴**
| バージョン | 日付 | 変更内容 | 作成者 |
|-----------|------|---------|--------|
| 1.0 | 2025-11-08 | 初版作成 | - |
| 1.1 | 2025-11-08 | 技術スタック詳細追加（Flask、React/TypeScript、インフラ） | - |
